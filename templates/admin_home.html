<!DOCTYPE html>
<html lang="ch">
<head>
    <meta charset="UTF-8">
    <title>Blog Dashboard</title>
    <link rel="stylesheet" href="/static/resources/css/home/home.css">
    <link rel="stylesheet" href="/static/viewer/css/viewer.css">
    <link rel="stylesheet" href="/static/fontawesome/css/all.min.css">
        <link rel="stylesheet" href="/static/font-awesome-4.7.0/css/font-awesome.min.css">
</head>
<body>
<div id="app">
    <h2>Blog Backend Dashboard</h2>
    <p>To display statistical data, statistical tables and important real-time data in the current system.</p>
    <div class="actions">
        <span :class="menu === 'home' ? 'active item' : 'item'" @click="set_menu('home')">Control Panel</span>
{#        <span :class="menu === 'info' ? 'active item' : 'item'" @click="set_menu('info')">Detail Information</span>#}
{#        <span :class="menu === 'version' ? 'active item' : 'item'" @click="set_menu('version')">Update Log</span>#}
    </div>
    <main class="home" v-show="menu==='home'">
        <div class="title">
            <div class="item tea">
                <div class="left">
                    <i class="fa fa-user-circle-o"></i>
                </div>
                <div class="right">
                    <h3>{{ user_count }}</h3>
                    <p>Total Users</p>
                </div>
            </div>
            <div class="item yellow">
                <div class="left">
                    <i class="fa fa-share-alt-square"></i>
                </div>
                <div class="right">
                    <h3>{{ article_count }}</h3>
                    <p>Total Articles</p>
                </div>
            </div>
{#            <div class="item red">#}
{#                <div class="left">#}
{#                    <i class="fa fa-internet-explorer"></i>#}
{#                </div>#}
{#                <div class="right">#}
{#                    <h3>109</h3>#}
{#                    <p>网址总数</p>#}
{#                </div>#}
{#            </div>#}
{#            <div class="item green">#}
{#                <div class="left">#}
{#                    <i class="fa fa-handshake-o"></i>#}
{#                </div>#}
{#                <div class="right">#}
{#                    <h3>66</h3>#}
{#                    <p>友链总数</p>#}
{#                </div>#}
{#            </div>#}
            <div class="item blue">
                <div class="left">
                    <i class="fa fa-pinterest-square"></i>
                </div>
                <div class="right">
                    <h3>{{ mood_count }}</h3>
                    <p>Total Communication message</p>
                </div>
            </div>
        </div>
        <div class="content">
            <div class="charts" id="main">

            </div>
            <div class="data_s">
                <div class="item">
                    <span class="new">Real Time</span>
                    <div class="left">
                        <i class="fa fa-odnoklassniki-square"></i>
                    </div>
                    <div class="right">
                        <h4>[[ online_count ]]</h4>
                        <p>Online User</p>
                    </div>
                </div>
                <div class="item">
                    <div class="left">
                        <i class="fa fa-user"></i>
                    </div>
                    <div class="right">
                        <h4>{{ today_sign }}</h4>
                        <p>Today Registration</p>
                    </div>
                </div>
                <div class="item">
                    <div class="left">
                        <i class="fa fa-envelope"></i>
                    </div>
                    <div class="right">
                        <h4>{{ email_count }}</h4>
                        <p>Email Sent</p>
                    </div>
                </div>
            </div>
        </div>
{#        <div class="footer">#}
{#            <div class="title">#}
{#                枫枫知道诗词赋#}
{#            </div>#}
{#            <div class="body">#}
{#                [[ poetry.content ]]#}
{#            </div>#}
{#            <div class="info">#}
{#                [[ poetry.info ]]#}
{#            </div>#}
{#            <div class="in_word">#}
{#                <button :class="btn_status ? '' : 'no_active'" @click="reset_word">换一句</button>#}
{#            </div>#}
{#        </div>#}
    </main>
    <main class="info" v-show="menu==='info'"></main>
    <main class="version" v-show="menu==='version'">
        <div class="title">
            <span>当前版本</span>
            <span>5.0.1</span>
        </div>
        <div class="body">
            <h3>历史版本</h3>
            <div class="content">
                <div class="item">
                    <div class="left">
                        <div class="max_circle">
                            <div class="circle"></div>
                        </div>
                    </div>
                    <div class="right">
                        <div class="v new">
                            v 5.0.1
                        </div>
                        <div class="date">
                            4天前
                        </div>
                        <ul class="info">
                            <li>后台请求分离，模板与api分离</li>
                            <li>文章悬浮目录全新升级</li>
                            <li>新增获取用户ip功能</li>
                            <li>心情可显示用户定位</li>
                            <li>后台数据中心可显示给用户</li>
                            <li>使用git部署项目，方便后期维护</li>
                            <li>新增第三方登录功能</li>
                            <li>配色统一</li>
                        </ul>
                        <div class="drawing">

                        </div>
                    </div>
                </div>
                <div class="item">
                    <div class="left">
                        <div class="max_circle">
                            <div class="circle"></div>
                        </div>
                    </div>
                    <div class="right">
                        <div class="v">
                            v 4.0.3
                        </div>
                        <div class="date">
                            [[ getDateDiff('2022-3-10') ]] <span>2022-3-11</span>
                        </div>
                        <ul class="info">
                            <li>修复了新闻无法获取的问题</li>
                        </ul>
                    </div>
                </div>
                <div class="item">
                    <div class="left">
                        <div class="max_circle">
                            <div class="circle"></div>
                        </div>
                    </div>
                    <div class="right">
                        <div class="v">
                            v 4.0.2
                        </div>
                        <div class="date">
                            [[ getDateDiff('2022-2-12') ]] <span>2022-2-12</span>
                        </div>
                        <ul class="info">
                            <li>取消音乐播放功能</li>
                            <li>添加打字机效果</li>
                        </ul>
                    </div>
                </div>
                <div class="item">
                    <div class="left">
                        <div class="max_circle">
                            <div class="circle"></div>
                        </div>
                    </div>
                    <div class="right">
                        <div class="v big">
                            v 4.0.1
                        </div>
                        <div class="date">
                            [[ getDateDiff('2021-12-29') ]] <span>2021-12-29</span>
                        </div>
                        <ul class="info">
                            <li>四代博客开发上线</li>
                            <li>最新一代的视图，新的验证机制</li>
                            <li>新增主题切换功能</li>
                        </ul>
                        <div class="drawing">
                            <img src="http://python.fengfengzhidao.com/023/20220311163603.png" alt="">
                            <img src="http://python.fengfengzhidao.com/023/20220311163627.png" alt="">
                            <img src="http://python.fengfengzhidao.com/023/20220311163726.png" alt="">
                        </div>
                    </div>
                </div>
                <div class="item">
                    <div class="left">
                        <div class="max_circle">
                            <div class="circle"></div>
                        </div>
                    </div>
                    <div class="right">
                        <div class="v big">
                            v 3.0.1
                        </div>
                        <div class="date">
                            [[ getDateDiff('2021-11-12') ]] <span>2021-11-12</span>
                        </div>
                        <ul class="info">
                            <li>三代个人博客</li>
                            <li>前后端分离</li>
                            <li>banner轮播图</li>
                            <li>Vue+Django DRF</li>
                        </ul>
                        <div class="drawing">
                            <img src="http://python.fengfengzhidao.com/023/20220311163418.png" alt="">
                            <img src="http://python.fengfengzhidao.com/023/20220311163503.png" alt="">
                        </div>
                    </div>
                </div>
                <div class="item">
                    <div class="left">
                        <div class="max_circle">
                            <div class="circle"></div>
                        </div>
                    </div>
                    <div class="right">
                        <div class="v big">
                            v 2.0.1
                        </div>
                        <div class="date">
                            [[ getDateDiff('2021-10-05') ]] <span>2021-10-05</span>
                        </div>
                        <ul class="info">
                            <li>界面美化</li>
                            <li>首页banner大图</li>
                        </ul>
                        <div class="drawing">
                            <img src="http://python.fengfengzhidao.com/023/20220311163050.png" alt="">
                            <img src="http://python.fengfengzhidao.com/023/20220311163123.png" alt="">
                            <img src="http://python.fengfengzhidao.com/023/20220311163216.png" alt="">
                            <img src="http://python.fengfengzhidao.com/023/20220311163305.png" alt="">
                        </div>
                    </div>
                </div>
                <div class="item">
                    <div class="left">
                        <div class="max_circle">
                            <div class="circle"></div>
                        </div>
                    </div>
                    <div class="right">
                        <div class="v big">
                            v 1.0.1
                        </div>
                        <div class="date">
                            [[ getDateDiff('2021-7-25') ]] <span>2021-7-25</span>
                        </div>
                        <ul class="info">
                            <li>首次使用django完成开发</li>
                        </ul>
                        <div class="drawing">
                            <img src="http://python.fengfengzhidao.icu/img/20211012083635.png" alt="">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

</div>
<script src="/static/vue/vue.js"></script>
<script src="/static/echarts/echarts.js"></script>
<script src="/static/utils/poetry.js" charset="utf-8"></script>
<script src="/static/jquery/jquery.min.js"></script>
<script src="/static/viewer/js/viewer.js"></script>

<script>
    function randomNum(minNum, maxNum) {
        switch (arguments.length) {
            case 1:
                return parseInt(Math.random() * minNum + 1, 10);
                break;
            case 2:
                return parseInt(Math.random() * (maxNum - minNum + 1) + minNum, 10);
                break;
            default:
                return 0;
                break;
        }
    }

    function init_echarts(seven_data){
        // -----------  echarts 配置 ----------- //

        let chartDom = document.getElementById('main');
        let myChart = echarts.init(chartDom);
        let option;

        // 配置信息
        option = {
            title: {
                text: '7 days active users'
            },
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    type: 'cross',
                    label: {
                        backgroundColor: '#6a7985'
                    }
                }
            },
            legend: {
                data: ['Login', 'Register']
            },
            toolbox: {},
            grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                containLabel: true
            },
            xAxis: [
                {
                    type: 'category',
                    boundaryGap: false,
                    data: seven_data['date']
                }
            ],
            yAxis: [
                {
                    type: 'value'
                }
            ],
            // 数据可以从后端去请求
            series: [
                {
                    name: 'Login',
                    type: 'line',
                    stack: 'Total',
                    areaStyle: {},
                    smooth: true,//设置折线图平滑
                    emphasis: {
                        focus: 'series'
                    },
                    data: seven_data['login_count']
                },
                {
                    name: 'Register',
                    type: 'line',
                    stack: 'Total',
                    smooth: true,//设置折线图平滑
                    areaStyle: {},
                    emphasis: {
                        focus: 'series'
                    },
                    data: seven_data['sign_count']
                },
            ]
        };
        option && myChart.setOption(option);

        //根据浏览器的大小来改变大小
        window.onresize = () => {
        myChart.resize();
    }
    }

    function init_seven_data(){
        $.get('/api/get_seven_data/', res => {
            init_echarts(res)
        })
    }
    init_seven_data()
    let timer = null;
    new Vue({
        el: '#app',
        delimiters: ["[[", "]]"],
        data: {
            // 当前菜单
            menu: 'home',
            // 诗句
            poetry: {
                // 内容
                content: '',
                // 作者
                info: '',
            },
            // 按钮是否可点击
            btn_status: true,
            // 获取时间距离现在的时间 几天前
            getDateDiff(date) {
                let dateTimeStamp = new Date(date).getTime()
                let result = ''
                let minute = 1000 * 60
                let hour = minute * 60
                let day = hour * 24
                let month = day * 30
                let now = new Date().getTime()
                let diffValue = now - dateTimeStamp
                if (diffValue < 0) return
                let monthC = diffValue / month
                let weekC = diffValue / (7 * day)
                let dayC = diffValue / day
                let hourC = diffValue / hour
                let minC = diffValue / minute
                if (monthC >= 1) {
                    result = "" + parseInt(monthC) + "months ago"
                } else if (weekC >= 1) {
                    result = "" + parseInt(weekC) + "weeks ago"
                } else if (dayC >= 1) {
                    result = "" + parseInt(dayC) + "days ago"
                } else if (hourC >= 1) {
                    result = "" + parseInt(hourC) + "hours ago"
                } else if (minC >= 1) {
                    result = "" + parseInt(minC) + "minutes ago"
                } else {
                    result = "Just now"
                }
                return result
            },

            online_count: 1,
        },
        created() {
            // 调用诗句
            this.reset_word()
            // 初始化菜单选项
            this.init_menu()
        },
        methods: {
            // 初始化获取菜单
            init_menu() {
                let menu = localStorage.getItem('menu')
                // 如果是home标签页，就去获取在线人数
                if (menu === 'home') {
                    this.init_online()
                }
                // 取出menu
                if (menu) {
                    this.menu = menu
                }
            },
            // 选择菜单
            set_menu(menu) {
                this.menu = menu
                if (menu === 'home') {
                    // 如果是在其他页面，home里面的echarts的长度就有问题，需要重新去计算
                    setTimeout(() => {
                        myChart.resize()
                    }, 200)
                    // 获取在线人数
                    this.init_online()
                } else {
                    // 清除这个获取在线人数的定时器
                    clearInterval(timer)
                }
                // 设置进本地存储
                localStorage.setItem('menu', menu)
            },
            // 获取每日诗句
            reset_word() {
                if (this.btn_status) {
                    this.btn_status = false
                    jinrishici.load((result) => {
                        let poem = result.data.content;
                        let info = "【" + result.data.origin.dynasty + "】" + result.data.origin.author + "《" + result.data.origin.title + "》";
                        this.poetry.content = poem
                        this.poetry.info = info
                    })
                }
                setTimeout(() => {
                    // 按下按钮需要4秒后才能点下一个
                    this.btn_status = true
                }, 4000)
            },
            // 获取在线人数
            get_online() {
                // 调用后台的地址
                $.get('/api/get_online/', (res) => {
                     this.online_count = res.data
                })
            },
            // 初始化在线人数
            init_online() {
                // 需要先调用一次这个方法
                this.get_online()
                timer = setInterval(this.get_online, 8000)  // 8秒调用一次获取当前在线人数的方法
            },


        },
    })

    $(function (){
        $('.drawing').viewer();
    })
</script>
</body>
</html>